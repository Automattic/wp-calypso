@import "@wordpress/base-styles/breakpoints";

$grid-horizontal-gutters: 24px;
$grid-vertical-gutters: 32px;

@mixin stats-desktop-grid($grid-template-areas, $grid-template-rows) {
	align-items: stretch;
	display: grid;
	grid-template-columns: repeat(12, 1fr);
	grid-template-rows: repeat($grid-template-rows, min-content);
	gap: $grid-vertical-gutters $grid-horizontal-gutters;
	grid-template-areas: $grid-template-areas;
}

@mixin stats-tablet-grid($grid-template-areas, $grid-template-rows) {
	@media (max-width: $break-large ) {
		grid-template-columns: repeat(8, 1fr);
		grid-template-rows: repeat($grid-template-rows, min-content);
		grid-template-areas: $grid-template-areas;
	}
}

@mixin stats-mobile-grid($grid-template-areas, $grid-template-rows) {
	@media (max-width: $break-medium ) {
		grid-template-columns: repeat(4, 1fr);
		grid-template-rows: repeat($grid-template-rows, min-content);
		gap: 0;
		grid-template-areas: $grid-template-areas;
	}
}

.stats__module-list.stats__module--unified.subscribers-page {
	@include stats-desktop-grid(
		"followers followers followers followers followers followers publicize publicize publicize publicize publicize publicize"
		"emails emails emails emails emails emails emails emails emails emails emails emails",
		2
	);

	@include stats-tablet-grid(
		"followers followers followers followers publicize publicize publicize publicize"
		"emails emails emails emails emails emails emails emails",
		2
	);

	@include stats-mobile-grid(
		"followers followers followers followers"
		"publicize publicize publicize publicize"
		"emails emails emails emails",
		3
	);

	@media (max-width: 660px) {
		padding: 0 16px;
	}

	.stats-module__wrapper--followers,
	.list-followers {
		grid-area: followers;
	}

	.stats-module__wrapper--publicize,
	.list-publicize {
		grid-area: publicize;
	}

	.stats-module__wrapper--emails,
	.list-emails {
		grid-area: emails;
	}
}

.stats__module-list--insights {
	&.is-jetpack {
		@include stats-desktop-grid(
			"tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories comments comments comments comments comments comments"
			"latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary social-followers social-followers social-followers social-followers social-followers social-followers",
			2
		);

		@include stats-tablet-grid(
			"tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories"
			"comments comments comments comments comments comments comments comments"
			"latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary"
			"social-followers social-followers social-followers social-followers social-followers social-followers social-followers social-followers social-followers",
			4
		);
	}

	@include stats-desktop-grid(
		"tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories"
		"comments comments comments comments comments comments shares shares shares shares shares shares"
		"latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary social-followers social-followers social-followers social-followers social-followers social-followers",
		3
	);

	@include stats-tablet-grid(
		"tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories tags-categories"
		"comments comments comments comments comments comments comments comments"
		"shares shares shares shares shares shares shares shares"
		"latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary latest-post-summary"
		"social-followers social-followers social-followers social-followers social-followers social-followers social-followers social-followers",
		5
	);

	.stats-module__wrapper--tags-categories {
		grid-area: tags-categories;
	}

	.list-comments {
		grid-area: comments;
	}

	.stats-module__wrapper--shares {
		grid-area: shares;
	}

	.list-shares {
		grid-area: shares;
	}

	.stats-module__wrapper--latest-post-summary {
		grid-area: latest-post-summary;
	}
}

/* custom video stats style to allow for scrolling */
.is-section-stats .list-videoplays {
	overflow-x: auto;

	.stats-card--header-and-body {
		width: fit-content;
		min-width: 100%;
	}
}

.is-section-stats .stats__module-list--traffic {
	// @TODO: Avoid using grid-gap by increasing `grid-template-rows` to add the divider for the next section,
	// which would make different gaps for sites.
	@include stats-desktop-grid(
		"posts posts posts posts posts posts posts referrers referrers referrers referrers referrers"
		"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
		"authors authors authors authors searchterms searchterms searchterms searchterms clicks clicks clicks clicks"
		"videoplays videoplays videoplays videoplays videoplays videoplays emails emails emails emails emails emails"
		"downloads downloads downloads downloads downloads downloads x x x x x x",
		6
	);

	@include stats-tablet-grid(
		"posts posts posts posts referrers referrers referrers referrers"
		"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
		"authors authors authors authors searchterms searchterms searchterms searchterms"
		"clicks clicks clicks clicks videoplays videoplays videoplays videoplays"
		"emails emails emails emails emails emails emails emails"
		"downloads downloads downloads downloads downloads downloads downloads downloads",
		7
	);

	@include stats-mobile-grid(
		"posts posts posts posts"
		"referrers referrers referrers referrers"
		"countryviews countryviews countryviews countryviews"
		"authors authors authors authors"
		"searchterms searchterms searchterms searchterms"
		"clicks clicks clicks clicks"
		"videoplays videoplays videoplays videoplays"
		"emails emails emails emails"
		"downloads downloads downloads downloads",
		10
	);

	// @TODO: Refactor hidden modules with a more flexible layout (e.g., Flexbox) to fit mass configuration to moduels in the future.
	// Hide the Authors module.
	&.stats__module-list--traffic-no-authors {
		// @TODO: Avoid using grid-gap by increasing `grid-template-rows` to add the divider for the next section,
		// which would make different gaps for sites.
		@include stats-desktop-grid(
			"posts posts posts posts posts posts posts referrers referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
			"searchterms searchterms searchterms searchterms clicks clicks clicks clicks videoplays videoplays videoplays videoplays"
			"emails emails emails emails emails emails downloads downloads downloads downloads downloads downloads",
			5
		);

		// Keep Emails occupying the whole row.
		@include stats-tablet-grid(
			"posts posts posts posts referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
			"searchterms searchterms searchterms searchterms clicks clicks clicks clicks"
			"videoplays videoplays videoplays videoplays videoplays videoplays videoplays videoplays"
			"emails emails emails emails emails emails emails emails"
			"downloads downloads downloads downloads downloads downloads downloads downloads",
			6
		);

		@include stats-mobile-grid(
			"posts posts posts posts"
			"referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews"
			"searchterms searchterms searchterms searchterms"
			"clicks clicks clicks clicks"
			"videoplays videoplays videoplays videoplays"
			"emails emails emails emails"
			"downloads downloads downloads downloads",
			8
		);
	}

	// Hide the videoplays module.
	&.stats__module-list--traffic-no-videos {
		// @TODO: Avoid using grid-gap by increasing `grid-template-rows` to add the divider for the next section,
		// which would make different gaps for sites.
		@include stats-desktop-grid(
			"posts posts posts posts posts posts posts referrers referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
			"authors authors authors authors searchterms searchterms searchterms searchterms clicks clicks clicks clicks"
			"emails emails emails emails emails emails downloads downloads downloads downloads downloads downloads",
			5
		);

		// Keep Emails occupying the whole row.
		@include stats-tablet-grid(
			"posts posts posts posts referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
			"authors authors authors authors searchterms searchterms searchterms searchterms"
			"clicks clicks clicks clicks clicks clicks clicks clicks"
			"emails emails emails emails emails emails emails emails"
			"downloads downloads downloads downloads downloads downloads downloads downloads",
			6
		);

		@include stats-mobile-grid(
			"posts posts posts posts"
			"referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews"
			"authors authors authors authors"
			"searchterms searchterms searchterms searchterms"
			"clicks clicks clicks clicks"
			"emails emails emails emails"
			"downloads downloads downloads downloads",
			8
		);
	}

	// Hide Authors and Videos modules.
	&.stats__module-list--traffic-no-authors.stats__module-list--traffic-no-videos {
		// @TODO: Avoid using grid-gap by increasing `grid-template-rows` to add the divider for the next section,
		// which would make different gaps for sites.
		@include stats-desktop-grid(
			"posts posts posts posts posts posts posts referrers referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
			"searchterms searchterms searchterms searchterms searchterms searchterms clicks clicks clicks clicks clicks clicks"
			"emails emails emails emails emails emails downloads downloads downloads downloads downloads downloads",
			5
		);

		@include stats-tablet-grid(
			"posts posts posts posts referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews countryviews countryviews countryviews countryviews"
			"searchterms searchterms searchterms searchterms clicks clicks clicks clicks"
			"emails emails emails emails emails emails emails emails"
			"downloads downloads downloads downloads downloads downloads downloads downloads",
			5
		);

		@include stats-mobile-grid(
			"posts posts posts posts"
			"referrers referrers referrers referrers"
			"countryviews countryviews countryviews countryviews"
			"searchterms searchterms searchterms searchterms"
			"clicks clicks clicks clicks"
			"emails emails emails emails"
			"downloads downloads downloads downloads",
			7
		);
	}

	.card.stats-module {
		margin-bottom: 0;
	}

	.stats-module__wrapper,
	.stats-card {
		width: 100%;
	}

	.stats-module__wrapper {

		.stats-card--header-and-body {
			display: flex;
			flex-flow: column nowrap;
			flex-grow: 1;
		}

		.stats-module,
		.stats-module__header {
			width: 100%;
		}
	}

	.stats-module__wrapper--posts {
		grid-area: posts;
	}

	.stats-module__wrapper--referrers {
		grid-area: referrers;
	}

	.stats-module__wrapper--countryviews {
		grid-area: countryviews;
	}

	.stats-module__wrapper--authors {
		grid-area: authors;
	}

	.stats-module__wrapper--searchterms {
		grid-area: searchterms;
	}

	.stats-module__wrapper--clicks {
		grid-area: clicks;
	}

	.stats-module__wrapper--videoplays {
		grid-area: videoplays;

		// Downloads module is disabled for Jetpack sites.
		// Expand the videoplays module to take up the entire row.
		&:last-child {
			grid-row-start: videoplays;
			grid-row-end: downloads;
			grid-column-start: videoplays;
			grid-column-end: downloads;
		}
	}

	.stats-module__wrapper--filedownloads {
		grid-area: downloads;
	}

	.stats-module__wrapper--emails {
		grid-area: emails;
	}
}
