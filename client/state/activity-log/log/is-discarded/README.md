# Activity Log Discarderer

Events in the Activity Log have a general notion of being _discarded_ or not.
Events, or activities, never truly disappear from a site.
However, in the course of restoring backups we can get into a state where
it appears as though specific events had never taken place because of
how the rewind zipped past it.
We say that these events are (temporarily) **discarded** when this happens.

<figure style="width: 721px; margin: auto;">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="721px" height="316px" version="1.1" content="&lt;mxfile userAgent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:57.0) Gecko/20100101 Firefox/57.0&quot; version=&quot;7.6.0&quot; editor=&quot;www.draw.io&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;06c22404-57f1-aae9-c3fb-c9af7092b9d0&quot; name=&quot;Page-1&quot;&gt;7ZxLc6M4EMc/ja9TgMCPY/zK7G6ylSofdmZvMiiYGkAuobz2069kBAa17WAGguOQQwKNEEK/v1pNCzJAs+j1luHt5p56JBxYhvc6QPOBZY3GQ/FbGt5Sg4NQavBZ4KUmc29YBf8RZTSU9SnwSFIqyCkNebAtG10ax8TlJRtmjL6Uiz3SsHzVLfYJMKxcHELrP4HHN6l17Bh7+3cS+Jvsyqahjqyx+8tn9ClW1xtY6HH3kx6OcFaXKp9ssEdfCia0GKAZo5SnW9HrjISya7NuS89bHjmat5uRmFc5wUpPeMbhk7r1G9Uw/pZ1xu52iDzBGKDpyybgZLXFrjz6IugL24ZHodgzxaZLo8BV249BGM5oSNmuHjQZzY3RSNgTzugvUjgyvJmYDpJn0JgvcRSEUjezXVWWscJxIv7cr0SBEK9J+ECTgAc0FmVccZ9E1DJ9JowHAuCdViAKPE/eyBSHgX/wjBt1YE05p5Fsnri5IPanan9uOsIIO1b1tayGvBZMqqNvCY0IZ2+iSDYqFHM1JvL9l73CbGXaFMSViQ4rTft5xXuuYkOhPYwZAcyLBjFfM7QuqdmA2ry1wblcLpzJ5NDgvDEnxtC4es6WxtmuxnncAOch4PxHPzorUbM7HJ0jQO22p1aJGuqQmmkCbH/12Cphc7rEBiOY+x5bJWzDLrHBEGbWWgjz1Z8vzC5BOwD0sgfd1vypx6ofCRoGq3c96LZcd5egYXz7vTXQX/3p0+7w6dMcA9B/9qDbiqG7BD0BoKd9DF0ttOrQEWeXLmAD1Ejs3chlD7EX05iUKRHPJytVljK+oT6NcbjYW6fuE3veMTfzkZkte9hwDLseWY/XJ2flo10u23Kywwsd6pzoUEZCzIPn8nLNoV5WV3iggWjJPttnazwNDVRCn5hL1FlWYf1Eq2jyTj0cM59wUI+Ahd8KxbayQFK9vebEOKdZWnGxkTZgr7+cQDVJwiRKL8nflKRjG99M2xo7I/W7TNDSjmr1V9Ur0oVktSNYR7+OeVqwoF1mw4q1esU2rVhbZzas6URN3V3pFTUkStBg57QoQbuchkUJk5rnifJ4EA31R14D/kOGdd8ctfdTBXkeTja5cOXOA+Yizop3FsuQVirjKi67wToZUaXEB6XnigtRqzPUYOohdVW1AtdW0YXWEQhMn/6mQHLncgkCcS5KIOjkBGwdPvpR828d8cCU7Cf3LhciFPsjhPLu5NqgUGBK95q8jH1R4hFDqH3x1A2o6ogHpol7L9OEUI5IoVmhvJsHaVAoMM18RV7Guijt6D6mFe3UTH3VkI5dId0kX7reHkUFMr35q+N4ndVgHCaWRf3a7TpqWikAzXugSBS43lqv71ZwsrUT92BcIcM2nBFMWczthbl0qqT6IQf7GIiTQ6S9HrXgWsiP5rr0upexz2CZTTPlsZMB/IgX3+Hiyb8Ncr5qaqbdHTbo8X+2NjyvbE36fNDjMmdUjXMTS9LIApzlF1TZTF6ALW6Fn4oHVbxYRKtM73ZwjuKQhM4a7i34yjxB9A4NPY9UiwbMRzOScMrI18Ux7hAHzP7GlEVYlBmGsvfXTGz5cos8ExVlf0lI+kxVlRJqghKMJO8Wt4u/558ThyxQmAGd0QhNZg1h0t5Phk9Qw5ZGkg2nGUCnkHtwQ5wkssuKrEqJg+PPTOVcRKXQ/liXH4WsBwJob7sjj1wFRLuQZEqZR5iuMHFB9c21aX+CVFj+dXUWoNRdaB7qkU57eVEbzqU8iBqZSHchq/z5eM9QVI0m23wEHFXTOR+Ijcqc7An0504jvkLs7r+2Tznv/6MBWvwP&lt;/diagram&gt;&lt;/mxfile&gt;"><defs/><g transform="translate(0.5,0.5)"><path d="M 0 216 L 0 216.16 L 8 216.14 L 16 215.98 L 24 215.86 L 32 215.85 L 40 216 L 39.54 216 L 40.01 226 L 40.5 236 L 39.92 246 L 40.74 256 L 40 266 L 40 265.94 L 32 266.12 L 24 265.78 L 16 265.94 L 8 266.09 L 0 266 L 0.08 266 L -0.69 256 L 0.37 246 L 0.67 236 L -0.17 226 L 0 216 L 0 216 Z Z" fill="#97d077" stroke="#6a9153" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(15.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="9" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 10px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">A</div></div></foreignObject><text x="5" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">A</text></switch></g><path d="M 200 216 L 200 215.93 L 208 215.92 L 216 216.05 L 224 216.05 L 232 216.21 L 240 216 L 239.41 216 L 239.65 226 L 239.35 236 L 239.52 246 L 239.75 256 L 240 266 L 240 265.85 L 232 266.06 L 224 266.03 L 216 266.19 L 208 265.96 L 200 266 L 199.44 266 L 200 256 L 200.71 246 L 199.83 236 L 199.56 226 L 200 216 L 200 216 Z Z" fill="#ffffff" stroke="#000000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(215.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 9px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">E</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">E</text></switch></g><path d="M 150 186 L 150 185.95 L 158 186.19 L 166 185.78 L 174 186.01 L 182 185.91 L 190 186 L 189.47 186 L 190.07 196 L 190.69 206 L 190.17 216 L 190.66 226 L 189.77 236 L 189.35 246 L 190.03 256 L 190 266 L 190 266.23 L 182 266.06 L 174 266.06 L 166 265.76 L 158 265.91 L 150 266 L 150.4 266 L 150.49 256 L 150.49 246 L 149.84 236 L 150.04 226 L 150.58 216 L 149.67 206 L 150.21 196 L 150 186 L 150 186 Z Z" fill="#ffe599" stroke="#a19060" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(165.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="9" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 10px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">D</div></div></foreignObject><text x="5" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">D</text></switch></g><path d="M 400 216 L 400 216.18 L 408 216 L 416 215.98 L 424 216.18 L 432 216.07 L 440 216 L 440.7 216 L 439.61 226 L 439.3 236 L 440.14 246 L 440.49 256 L 440 266 L 440 265.82 L 432 266.2 L 424 265.8 L 416 265.78 L 408 265.79 L 400 266 L 399.93 266 L 400.63 256 L 399.9 246 L 400.61 236 L 400 226 L 400 216 L 400 216 Z Z" fill="#ffffff" stroke="#000000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(416.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">I</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">I</text></switch></g><path d="M 300 216 L 300 216.02 L 308 215.9 L 316 216.02 L 324 215.84 L 332 216.13 L 340 216 L 339.64 216 L 340.39 226 L 339.5 236 L 339.31 246 L 339.58 256 L 340 266 L 340 266.24 L 332 266.16 L 324 266.18 L 316 265.77 L 308 266.23 L 300 266 L 299.84 266 L 300.35 256 L 299.42 246 L 300.06 236 L 300.32 226 L 300 216 L 300 216 Z Z" fill="#ffffff" stroke="#000000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(315.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 9px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">G</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">G</text></switch></g><path d="M 500 216 L 500 216.23 L 508 216.1 L 516 216.16 L 524 216 L 532 215.76 L 540 216 L 539.59 216 L 540.27 226 L 539.38 236 L 540.3 246 L 539.34 256 L 540 266 L 540 266.24 L 532 266.13 L 524 266.23 L 516 265.89 L 508 266.07 L 500 266 L 500.15 266 L 500.48 256 L 500.27 246 L 500.27 236 L 499.73 226 L 500 216 L 500 216 Z Z" fill="#ffffff" stroke="#000000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(516.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">K</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">K</text></switch></g><path d="M 600 216 L 600 215.96 L 608 215.79 L 616 215.87 L 624 215.8 L 632 215.91 L 640 216 L 639.32 216 L 640.51 226 L 640.48 236 L 640.19 246 L 639.61 256 L 640 266 L 640 265.96 L 632 265.98 L 624 266.22 L 616 266.22 L 608 266.02 L 600 266 L 600.18 266 L 600.25 256 L 600.09 246 L 600.33 236 L 600.32 226 L 600 216 L 600 216 Z Z" fill="#ffffff" stroke="#000000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(614.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="11" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 12px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">M</div></div></foreignObject><text x="6" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">M</text></switch></g><path d="M 100 216 L 100 215.75 L 108 216.02 L 116 215.88 L 124 216.11 L 132 215.96 L 140 216 L 139.26 216 L 140.12 226 L 140.7 236 L 140.01 246 L 140.23 256 L 140 266 L 140 266.05 L 132 266.21 L 124 266.22 L 116 266.22 L 108 265.87 L 100 266 L 99.53 266 L 99.38 256 L 100.32 246 L 100.24 236 L 99.37 226 L 100 216 L 100 216 Z Z" fill="#97d077" stroke="#6a9153" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(116.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">C</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">C</text></switch></g><path d="M 250 216 L 250 215.96 L 258 215.89 L 266 215.77 L 274 215.92 L 282 216.09 L 290 216 L 289.3 216 L 289.83 226 L 289.98 236 L 289.9 246 L 289.95 256 L 290 266 L 290 266.11 L 282 266.17 L 274 265.84 L 266 266.12 L 258 266.05 L 250 266 L 250.13 266 L 249.33 256 L 249.75 246 L 250.69 236 L 249.62 226 L 250 216 L 250 216 Z Z" fill="#97d077" stroke="#6a9153" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(266.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">F</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">F</text></switch></g><path d="M 550 216 L 550 215.87 L 558 216.09 L 566 215.84 L 574 215.78 L 582 215.97 L 590 216 L 590.38 216 L 589.73 226 L 589.32 236 L 590.15 246 L 589.59 256 L 590 266 L 590 265.8 L 582 265.82 L 574 266.08 L 566 266.08 L 558 265.8 L 550 266 L 549.43 266 L 549.97 256 L 549.93 246 L 550.41 236 L 549.67 226 L 550 216 L 550 216 Z Z" fill="#97d077" stroke="#6a9153" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(566.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="7" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 8px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">L</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">L</text></switch></g><path d="M 350 186 L 350 185.77 L 358 185.86 L 366 186.12 L 374 185.89 L 382 185.87 L 390 186 L 390.3 186 L 390.74 196 L 390.14 206 L 389.86 216 L 389.81 226 L 389.71 236 L 390.25 246 L 389.31 256 L 390 266 L 390 265.92 L 382 266.23 L 374 266.08 L 366 265.75 L 358 266.19 L 350 266 L 350.39 266 L 350 256 L 350.35 246 L 350.44 236 L 350.11 226 L 350.15 216 L 350.67 206 L 349.62 196 L 350 186 L 350 186 Z Z" fill="#ffe599" stroke="#a19060" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(365.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="9" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 10px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">H</div></div></foreignObject><text x="5" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">H</text></switch></g><path d="M 450 186 L 450 186.08 L 458 185.96 L 466 185.89 L 474 186.2 L 482 186.01 L 490 186 L 489.28 186 L 490.5 196 L 490.3 206 L 489.77 216 L 490.74 226 L 489.71 236 L 489.38 246 L 490.39 256 L 490 266 L 490 265.9 L 482 266.01 L 474 265.99 L 466 266.02 L 458 265.88 L 450 266 L 449.39 266 L 449.92 256 L 450.32 246 L 450.44 236 L 450.6 226 L 449.89 216 L 450.28 206 L 449.85 196 L 450 186 L 450 186 Z Z" fill="#ffe599" stroke="#a19060" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(465.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 9px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">J</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">J</text></switch></g><path d="M 50 216 L 50 215.98 L 58 216.13 L 66 216.03 L 74 216.17 L 82 215.87 L 90 216 L 89.65 216 L 90.49 226 L 90.39 236 L 90.61 246 L 89.44 256 L 90 266 L 90 265.95 L 82 266.11 L 74 265.87 L 66 265.96 L 58 265.98 L 50 266 L 49.87 266 L 50.69 256 L 49.76 246 L 49.44 236 L 50.38 226 L 50 216 L 50 216 Z Z" fill="#ffffff" stroke="#000000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(65.5,234.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 9px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">B</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">B</text></switch></g><path d="M 170 146 Q 170 136 95 136 Q 20 136 20 146" fill="none" stroke="#6a9153" stroke-width="4" stroke-miterlimit="10" pointer-events="none"/><path d="M 470 66 Q 470 56 370 56 Q 270 56 270 66" fill="none" stroke="#6a9153" stroke-width="4" stroke-miterlimit="10" pointer-events="none"/><path d="M 370 106 Q 370 96 245 96 Q 120 96 120 106" fill="none" stroke="#6a9153" stroke-width="4" stroke-miterlimit="10" pointer-events="none"/><path d="M 470 186 L 470 66" fill="none" stroke="#a19060" stroke-opacity="0.25" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 4" pointer-events="none"/><path d="M 270 216 L 270 66" fill="none" stroke="#6a9153" stroke-opacity="0.25" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 4" pointer-events="none"/><path d="M 370.14 186.14 L 370 106" fill="none" stroke="#a19060" stroke-opacity="0.25" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 4" pointer-events="none"/><path d="M 120 216 L 120 106" fill="none" stroke="#6a9153" stroke-opacity="0.25" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 4" pointer-events="none"/><path d="M 170.14 186.14 L 170 146" fill="none" stroke="#a19060" stroke-opacity="0.25" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 4" pointer-events="none"/><path d="M 20 216 L 20 146" fill="none" stroke="#6a9153" stroke-opacity="0.25" stroke-width="4" stroke-miterlimit="10" stroke-dasharray="4 4" pointer-events="none"/><path d="M 520 0 L 520 -0.69 L 530 -0.26 L 540 -0.03 L 550 -0.18 L 560 0.51 L 570 -0.03 L 580 0.7 L 590 -0.7 L 600 -0.24 L 610 -0.07 L 620 -0.02 L 630 -0.44 L 640 -0.34 L 650 0.22 L 660 -0.51 L 670 -0.42 L 680 0.23 L 690 -0.28 L 700 0.28 L 710 0.52 L 720 0 L 720.37 0 L 719.68 10 L 720.28 20 L 719.27 30 L 720.34 40 L 719.56 50 L 720.69 60 L 720.31 70 L 719.68 80 L 720.47 90 L 720.05 100 L 719.64 110 L 719.59 120 L 719.47 130 L 720.54 140 L 719.76 150 L 720 160 L 720 160.47 L 710 160.47 L 700 159.37 L 690 159.31 L 680 160.64 L 670 159.88 L 660 159.64 L 650 160.39 L 640 159.44 L 630 160.44 L 620 159.81 L 610 159.8 L 600 160.29 L 590 160.2 L 580 160.49 L 570 159.89 L 560 160.21 L 550 159.44 L 540 160.05 L 530 160.48 L 520 160 L 519.35 160 L 519.98 150 L 520.23 140 L 519.75 130 L 520.66 120 L 519.39 110 L 520.12 100 L 520.33 90 L 520.63 80 L 520.02 70 L 520.2 60 L 520.06 50 L 519.86 40 L 520.45 30 L 519.27 20 L 520.36 10 L 520 0 L 520 0 Z Z" fill="#d4e1f5" stroke="#304057" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><path d="M 540 60 L 540 60.14 L 548 60.07 L 556 60.1 L 564 60.07 L 572 60.18 L 580 60 L 579.55 60 L 579.49 70 L 580.6 80 L 580 90 L 579.44 100 L 580 110 L 580 110.22 L 572 110.09 L 564 109.99 L 556 109.85 L 548 110.1 L 540 110 L 540.38 110 L 540.64 100 L 539.37 90 L 539.8 80 L 539.54 70 L 540 60 L 540 60 Z Z" fill="#97d077" stroke="#6a9153" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(555.5,78.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="9" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 10px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">X</div></div></foreignObject><text x="5" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">X</text></switch></g><path d="M 660 60 L 660 60.04 L 668 60.03 L 676 60.18 L 684 60.09 L 692 60.04 L 700 60 L 700.35 60 L 700.11 70 L 699.67 80 L 699.66 90 L 700.34 100 L 700 110 L 700 110.02 L 692 110.1 L 684 110.18 L 676 110.13 L 668 110.1 L 660 110 L 659.69 110 L 660.21 100 L 660.39 90 L 659.66 80 L 660.55 70 L 660 60 L 660 60 Z Z" fill="#ffffff" stroke="#000000" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(675.5,78.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 9px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Z</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">Z</text></switch></g><path d="M 600 30 L 600 29.8 L 608 30.2 L 616 29.9 L 624 29.91 L 632 30.15 L 640 30 L 639.84 30 L 639.75 40 L 640.36 50 L 640.25 60 L 640.48 70 L 639.41 80 L 639.78 90 L 639.91 100 L 640 110 L 640 110.16 L 632 110.09 L 624 109.89 L 616 110 L 608 110.11 L 600 110 L 600.24 110 L 599.63 100 L 600.67 90 L 599.26 80 L 599.71 70 L 599.76 60 L 599.73 50 L 600.6 40 L 600 30 L 600 30 Z Z" fill="#ffe599" stroke="#a19060" stroke-linejoin="round" stroke-linecap="round" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(615.5,78.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="8" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 9px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">Y</div></div></foreignObject><text x="4" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">Y</text></switch></g><g transform="translate(540.5,123.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="39" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 40px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">backup</div></div></foreignObject><text x="20" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">backup</text></switch></g><g transform="translate(598.5,123.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="42" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 43px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">restore</div></div></foreignObject><text x="21" y="12" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">restore</text></switch></g><g transform="translate(661.5,121.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="37" height="27" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 38px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">normal<br />event</div></div></foreignObject><text x="19" y="20" fill="#000000" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">normal&lt;br&gt;event</text></switch></g><g transform="translate(595.5,7.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Comic Sans MS; color: rgb(87, 115, 156); line-height: 1.2; vertical-align: top; width: 49px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">LEGEND</div></div></foreignObject><text x="24" y="12" fill="#57739C" text-anchor="middle" font-size="12px" font-family="Comic Sans MS">LEGEND</text></switch></g><path d="M 30 306 L 599.9 306" fill="none" stroke="#304057" stroke-width="3" stroke-miterlimit="10" stroke-dasharray="9 9" pointer-events="none"/><path d="M 606.65 306 L 597.65 310.5 L 599.9 306 L 597.65 301.5 Z" fill="#304057" stroke="#304057" stroke-width="3" stroke-miterlimit="10" pointer-events="none"/><path d="M 307 295 L 307 295.62 L 316 294.39 L 325 295.61 L 334 295.36 L 343 294.26 L 352 295 L 352.09 295 L 352.13 299 L 351.94 303 L 351.83 307 L 351.82 311 L 352 315 L 352 314.31 L 343 314.65 L 334 315.24 L 325 315.36 L 316 314.85 L 307 315 L 306.95 315 L 306.94 311 L 307.15 307 L 306.77 303 L 307.15 299 L 307 295 L 307 295 Z Z" fill="#ffffff" stroke="none" pointer-events="none"/><g transform="translate(314.5,297.5)"><switch><foreignObject style="overflow:visible;" pointer-events="all" width="29" height="15" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 14px; font-family: Comic Sans MS; color: rgb(48, 64, 87); line-height: 1.2; vertical-align: top; width: 30px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">time</div></div></foreignObject><text x="15" y="15" fill="#304057" text-anchor="middle" font-size="14px" font-family="Comic Sans MS">time</text></switch></g></g></svg>
<!-- created in draw.io with above svg content -->
</figure>

Actually knowing whether or not an activity has been discarded however can be
difficult to ascertain; it depends on the perspective from which we analyze
the stream of events and it's inherently a recursive problem.

> A discarded event is an event which is hidden by a restore operation which
> itself is not also discarded from the perspective from which we are looking.

This module exists to take an existing list of activity log events and augment
that list with an accurate value for `isDiscarded` based on the combination of
rewind/restore timestamp pairs (the restore event itself and the backup event
which it is restoring) and the timestamp of our point of observation.


## Usage

The simplest way to use this is to pass in a list of activity log events to the
built in helper method, `rewriteStream`.

```js
const log = rewriteStream( getActivityLogs( … ) )
```

Of course, this _is_ just a helper around the two more fundamental bits: one
which extracts the restore events from the list and one which uses that
information to calculate the `isDiscarded` property.

```js
const events = getActivityLogs( … )
const rewinds = getRewinds( events )
const isDiscarded = makeIsDiscarded( rewinds, Date.now() )
const log = events.map( e => ( { ...e, activityIsDiscarded: isDiscarded( e.activityTs ) } ) )
```

If we wanted to re-examine from a mid-stream perspective we can do that too.
We just have to pass in the timestamp from the mid-stream event which we will
use as our point of observation.

```js
const log = rewriteStream( getActivityLogs( … ), selectedEvent.activityTs )
```

Obviously every event newer than the mid-stream event will be discarded because
when we examine the activity log from the perspective of the time that our
selected event occurred, none of the newer activity had yet occurred.

## Theory of operation

In order for this algorithm to work we need to know all restore operation timestamps
and their associated backup event timestamps from the oldest event under examination
until the point in time form which we are calculating `isDiscarded`. In most cases
this will be "now," meaning we need all rewind operations from the oldest event we
have until the very latest point in time.

It's not too difficult of an algorithm and can be inferred from its definition:

> A discarded event is an event which is hidden by a restore operation which
> itself is not also discarded from the perspective from which we are looking.

We thus need to find for any given event timestamp all of the restore operations
which would cover that event in time. Once we have that list, we start trying to
eliminate those covering restores by checking if they themselves are discarded;
this is the recursive part. We will end up recursing for every level of overlapping
restore operations. If we have any remaining covering restores at the end then we
know the event should be considered discarded.

This algorithm by itself does't scale, especially with many restore operations.
However, like many recursive operations, basic memoization can take it from
practically unusable to sufficiently fast.

Basic testing has revealed that this should perform well on any recent computer
within a single render-frame given event streams with a thousand events or fewer.

### Example

In the diagram at the top we can examine event D, which itself is a restore operation
restoring event A. Should event D be considered discarded from the perspective of our
most-recent event, event M?

  1. Find all covering restores: D is only covered by [ H restoring C ]
  2. Eliminate discarded restores:

    1. For event H, find covering restores: H is covered by [ J restoring F ]
    2. Eliminate discarded restores: No more restores are covered
    3. Restore event H is _discarded_ by J

  3. Since no restore events are left covering D, D _is not discarded_.
